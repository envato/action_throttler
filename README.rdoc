= Action Throttler

== Introduction

Action Throttler is an easy to use Rails plugin to quickly throttle application actions based on configurable duration and limit.

Brought to you by Envato - http://envato.com/ and Wuit - http://wuit.com/.


== Features

* Easy to use, easy to configure
* Lightweight
* Supports both Rails 2 and 3


== Limitations

* Supports ActiveRecord only
* Uses Rake instead of Rails Generator for file generation (for compatibility purpose)


== Usage

=== Download and install the plugin

==== Rails 2

  script/plugin install http://fredwu@github.com/fredwu/action_throttler.git

==== Rails 3

  rails plugin install http://fredwu@github.com/fredwu/action_throttler.git


=== Set up the plugin

To generate the migration file and migrate the database:

  rake action_throttler:migrate
  rake db:migrate

Or alternatively:

  rake action_throttler:auto_migrate


=== Configure the actions

The configuration file is located at <tt>PATH_TO_YOUR_APP/config/initializers/action_throttler.rb</tt>.

The configuration block looks like this:

  ActionThrottler::Actions.add :mail do |action|
    action.duration = 1.hour
    action.limit    = 10
  end

You can add as many configuration blocks as you like, just make sure you label them properly (i.e. like <tt>:mail</tt> in the example).

In the example, we are setting the <tt>:mail</tt> action to perform at most <em>10</em> times within <em>1</em> hour duration.


=== Register the actions in your app

Now we will need to register the actions so they are recorded in the database.

To simply run an action, in your app (presumably somewhere in the controller), do this:

  ActionThrottler::Actions.run(:mail)

<tt>ActionThrottler::Actions.run</tt> will return <tt>true</tt> or <tt>false</tt> depending on whether or not the action is being throttled.

<tt>ActionThrottler::Actions.run</tt> has an alias <tt>ActionThrottler::Actions.can_run</tt> and a negative alias <tt>ActionThrottler::Actions.cannot_run</tt>.

Typically, we would want to produce feedback to the user when an action is throttled, you can do so by:

  if ActionThrottler::Actions.cannot_run(:mail)
    # tell the user that this action is not performed
  end

<tt>ActionThrottler::Actions.run</tt> also takes an optional <tt>reference</tt> parameter:

  ActionThrottler::Actions.run(:mail, @current_user)

The reference parameter is very useful because we can track and throttle the action based on a reference, such as a user. The parameter accepts a <tt>String</tt>, an <tt>Integer</tt> or an <tt>ActiveRecord</tt> object.

Note that <tt>ActionThrottler::Actions.run</tt> and its aliases will perform the action when possible. If you only want to check to see if an action can be performed, you can do this:

  ActionThrottler::Actions.can_be_run?(:mail, @current_user)

<tt>ActionThrottler::Actions.can_be_run?</tt> returns <tt>true</tt> or <tt>false</tt> without performing the action.


== Author

Copyright (c) 2010 Fred Wu, released under the MIT license

* Envato http://envato.com/
* Wuit http://wuit.com/
